# RNN åœ¨é¡¾å®¢è¯„è®ºæƒ…æ„Ÿåˆ†æä¸­çš„åº”ç”¨

> åŸæ–‡ï¼š<https://towardsdatascience.com/application-of-rnn-for-customer-review-sentiment-analysis-178fa82e9aaf?source=collection_archive---------8----------------------->

åœ¨æˆ‘ä¹‹å‰çš„åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘å†™äº†å…³äºä½¿ç”¨ BeautifulSoup æ”¶é›†ä¸¤åƒå¤šæ¡ Flixbus å®¢æˆ·è¯„è®ºï¼Œå¹¶é€šè¿‡æ‰§è¡Œ NLP åˆ†ææ¥è¯†åˆ«å…¬å¸çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚

åŸºäºä¹‹å‰çš„æ•…äº‹ï¼Œæˆ‘å†³å®šä½¿ç”¨æ”¶é›†çš„æ–‡æœ¬æ•°æ®æ¥è®­ç»ƒä¸€ä¸ªé€’å½’ç¥ç»ç½‘ç»œæ¨¡å‹æ¥é¢„æµ‹å®¢æˆ·çš„æƒ…ç»ªï¼Œè¿™è¢«è¯æ˜æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œåœ¨æµ‹è¯•é›†ä¸Šè¾¾åˆ° 95.93%çš„å‡†ç¡®ç‡ã€‚

ä»€ä¹ˆæ˜¯æƒ…æ„Ÿåˆ†æï¼Ÿç»´åŸºç™¾ç§‘æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„è§£é‡Š:

> â€œâ€¦â€¦æƒ…æ„Ÿåˆ†ææ—¨åœ¨ç¡®å®šå‘è¨€äººã€ä½œè€…æˆ–å…¶ä»–ä¸»ä½“å¯¹æŸä¸ªä¸»é¢˜çš„æ€åº¦ï¼Œæˆ–å¯¹æŸä¸ªæ–‡æ¡£ã€äº’åŠ¨æˆ–äº‹ä»¶çš„æ•´ä½“ä¸Šä¸‹æ–‡ææ€§æˆ–æƒ…æ„Ÿååº”ã€‚â€â€”â€”[æ¥æº](https://en.wikipedia.org/wiki/Sentiment_analysis)

äº‹ä¸å®œè¿Ÿï¼Œè®©æˆ‘ä»¬å¼€å§‹å®æ–½å§ã€‚

## åŠ è½½å’Œå‡†å¤‡æ•°æ®

é¦–å…ˆï¼Œæˆ‘åŠ è½½äº†ä¸€ä¸ª csv æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å« 1ï¼Œ780 æ¡è‹±æ–‡å®¢æˆ·è¯„è®ºï¼Œç›¸åº”çš„è¯„åˆ†ä» 1 åˆ° 5ï¼Œå…¶ä¸­ 1 æ˜¯æœ€ä½(è´Ÿé¢)è¯„åˆ†ï¼Œ5 æ˜¯æœ€é«˜(æ­£é¢)è¯„åˆ†ã€‚ä»¥ä¸‹æ˜¯å¯¹æ•°æ®æ¡†çš„å¿«é€Ÿæµè§ˆ:

![](img/fd6d03346610c5defbeb785b36d7033c.png)

Data frame with customer reviews and rating

å¤ªå¥½äº†ï¼ç°åœ¨æˆ‘ä»¬æœ‰äº†å¯ä»¥å¤„ç†çš„æ•°æ®ã€‚ç„¶è€Œï¼Œç”±äºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯é¢„æµ‹æƒ…ç»ªâ€”â€”æ— è®ºè¯„è®ºæ˜¯æ­£é¢çš„è¿˜æ˜¯è´Ÿé¢çš„ï¼Œæˆ‘ä»¬å¿…é¡»ä¸ºè¿™é¡¹ä»»åŠ¡é€‰æ‹©é€‚å½“çš„æ•°æ®ã€‚

ä½¿ç”¨è®¡æ•°å™¨åŠŸèƒ½ï¼Œæˆ‘æ³¨æ„åˆ°æ¯ä¸ªè¯„åˆ†çš„è¯„è®ºåˆ†å¸ƒç›¸å½“ä¸å¹³è¡¡:

```
# Count of reviews per rating
Counter({5: 728, 4: 416, 1: 507, 3: 86, 2: 43})
```

ä¸ºäº†å¹³è¡¡å®ƒï¼Œå¹¶ç¡®ä¿æƒ…ç»ªç±»çš„è‰¯å¥½è¡¨ç°ï¼Œæˆ‘å†³å®šä¿ç•™â€œç§¯æâ€çš„ 5 æ˜Ÿè¯„è®ºï¼Œè€Œâ€œæ¶ˆæâ€çš„ 1 æ˜Ÿå’Œ 2 æ˜Ÿè¯„è®ºã€‚ç»“æœï¼Œæˆ‘å¾—åˆ°äº†æ€»å…± 1278 æ¡è¯„è®ºçš„æ ·æœ¬é‡ã€‚ä¸å¤šï¼Œä½†è®©æˆ‘ä»¬çœ‹çœ‹èƒ½ä»ä¸­å¾—åˆ°ä»€ä¹ˆã€‚

åœ¨å¤„ç†è¯„è®ºä¹‹å‰ï¼Œåº”è¯¥ä½¿ç”¨åˆ—è¡¨ç†è§£å¯¹æƒ…æ„Ÿè¿›è¡ŒäºŒè¿›åˆ¶ç¼–ç ï¼Œ1 è¡¨ç¤ºç§¯ææƒ…æ„Ÿï¼Œ0 è¡¨ç¤ºæ¶ˆææƒ…æ„Ÿã€‚

```
data['Sentiment'] = [1 if x > 4 else 0 for x in data.Rating]
```

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªåŸºæœ¬çš„è®¾ç½®ï¼Œæ˜¯æ—¶å€™ç»§ç»­è¿›è¡Œæ•°æ®é¢„å¤„ç†äº†ã€‚

## æ•°æ®é¢„å¤„ç†

RNN è¾“å…¥éœ€è¦æ•°ç»„æ•°æ®ç±»å‹ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°†â€œè¯„è®ºâ€è½¬æ¢ä¸º **X** æ•°ç»„ï¼Œå¹¶å°†â€œæƒ…ç»ªâ€è½¬æ¢ä¸º **y** æ•°ç»„ã€‚

```
X, y = (data['Review'].values, data['Sentiment'].values)
```

æ–‡æœ¬æ•°æ®åœ¨è¾“å…¥ RNN æ¨¡å‹ä¹‹å‰å¿…é¡»è¿›è¡Œæ•´æ•°ç¼–ç ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨ Keras åº“ä¸­çš„åŸºæœ¬å·¥å…·è½»æ¾å®ç°ï¼Œåªéœ€å‡ è¡Œä»£ç :

```
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequencestk = Tokenizer(lower = True)
tk.fit_on_texts(X)
X_seq = tk.texts_to_sequences(X)
X_pad = pad_sequences(X_seq, maxlen=100, padding='post')
```

é¦–å…ˆï¼Œåº”è¯¥é€šè¿‡åœ¨æ•°æ®é›†ä¸Šå®‰è£…æ ‡è®°å™¨ç±»æ¥æ ‡è®°æ–‡æœ¬ã€‚å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä½¿ç”¨â€œlower = Trueâ€å‚æ•°å°†æ–‡æœ¬è½¬æ¢æˆå°å†™ï¼Œä»¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚ç„¶åï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ texts_to_sequences ç±»å°†å•è¯(æ ‡è®°)åˆ—è¡¨æ˜ å°„åˆ°æ¯ä¸ªå”¯ä¸€å•è¯çš„å”¯ä¸€æ•´æ•°åˆ—è¡¨ã€‚

![](img/980487b4e3093b0a590f432dbb5d3068.png)

Dictionary

ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œä¸‹é¢æ‚¨å¯ä»¥çœ‹åˆ°åœ¨åº”ç”¨é¢„å¤„ç†åï¼ŒåŸå§‹è¯„è®ºæ˜¯å¦‚ä½•å˜æˆä¸€ä¸ªæ•´æ•°åºåˆ—çš„ã€‚

![](img/92b9c0331f182c298ebd3d5df54cf74d.png)

Original reviews vs after tokenization and sequencing

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•°åˆ—è¡¨ä¸Šçš„ pad_sequences ç±»æ¥ç¡®ä¿æ‰€æœ‰è¯„è®ºçš„é•¿åº¦ç›¸åŒï¼Œè¿™æ˜¯ä¸º RNN æ¨¡å‹å‡†å¤‡æ•°æ®çš„éå¸¸é‡è¦çš„ä¸€æ­¥ã€‚åº”ç”¨è¿™ä¸ªç±»è¦ä¹ˆå°†è¯„è®ºç¼©çŸ­åˆ° 100 ä¸ªæ•´æ•°ï¼Œè¦ä¹ˆåœ¨å®ƒä»¬æ›´çŸ­çš„æƒ…å†µä¸‹ç”¨ 0 å¡«å……å®ƒä»¬ã€‚

![](img/ac09b16722b153048d741dc48e37138b.png)

Reviews after padding

ç°åœ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ sklearn çš„ train_test_split å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå¹¶ä¿ç•™ 25%çš„åŸå§‹æ•°æ®ä½œä¸ºä¿ç•™é›†:

```
from sklearn.model_selection import train_test_splitX_train, X_test, y_train, y_test = train_test_split(X_pad, y, test_size = 0.25, random_state = 1)
```

æ­¤å¤–ï¼Œè®­ç»ƒé›†å¯ä»¥åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†:

```
batch_size = 64
X_train1 = X_train[batch_size:]
y_train1 = y_train[batch_size:]X_valid = X_train[:batch_size]
y_valid = y_train[:batch_size]
```

æ˜¯æ—¶å€™ä½¿ç”¨ Keras æ„å»ºæ¨¡å‹å¹¶ä½¿å…¶ç¬¦åˆè®­ç»ƒæ•°æ®äº†:

```
from keras.models import Sequential
from keras.layers import Embedding, LSTM, Dense, Dropoutvocabulary_size = len(tk.word_counts.keys())+1
max_words = 100embedding_size = 32
model = Sequential()
model.add(Embedding(vocabulary_size, embedding_size, input_length=max_words))
model.add(LSTM(200))
model.add(Dense(1, activation='sigmoid'))model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
```

ç”±äºåµŒå…¥éœ€è¦è¯æ±‡çš„å¤§å°å’Œè¾“å…¥åºåˆ—çš„é•¿åº¦ï¼Œæˆ‘ä»¬å°†è¯æ±‡å¤§å°è®¾ç½®ä¸º Tokenizer å­—å…¸ä¸­çš„å•è¯æ•°+ 1ï¼Œå°†è¾“å…¥é•¿åº¦è®¾ç½®ä¸º 100 (max_words)ï¼Œå…¶ä¸­åä¸€ä¸ªå‚æ•°çš„å€¼å¿…é¡»ä¸å¡«å……(ï¼idspnonenote)çš„å€¼ç›¸åŒã€‚).åµŒå…¥å¤§å°å‚æ•°æŒ‡å®šå°†ä½¿ç”¨å¤šå°‘ç»´åº¦æ¥è¡¨ç¤ºæ¯ä¸ªå•è¯ã€‚é€šå¸¸ä½¿ç”¨å€¼ 50ã€100 å’Œ 300 ä½œä¸ºè¯¥å‚æ•°çš„è¾“å…¥ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒæ•´æ¨¡å‹å€¼ 32 å¯è·å¾—æœ€ä½³ç»“æœã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªéšè—çš„ 200 ä¸ªå†…å­˜å•å…ƒçš„ LSTM å±‚ã€‚æ½œåœ¨åœ°ï¼Œæ·»åŠ æ›´å¤šçš„å±‚å’Œå•å…ƒå¯ä»¥å¯¼è‡´æ›´å¥½çš„ç»“æœã€‚

æœ€åï¼Œæˆ‘ä»¬æ·»åŠ å¸¦æœ‰ sigmoid æ¿€æ´»å‡½æ•°çš„è¾“å‡ºå±‚æ¥é¢„æµ‹è¯„è®ºä¸ºæ­£é¢çš„æ¦‚ç‡ã€‚

åœ¨å¯¹æ¨¡å‹è¿›è¡Œ 10 ä¸ªæ—¶æœŸçš„è®­ç»ƒåï¼Œæˆ‘ä»¬åœ¨éªŒè¯é›†å’Œæµ‹è¯•é›†ä¸Šåˆ†åˆ«è·å¾—äº† 98.44%å’Œ 95.93%çš„å‡†ç¡®ç‡ã€‚

![](img/8c56b50770a3aa3f6cf430496b94acaa.png)

Training and testing accuracy results

![](img/341d5fd64b304f9e74fafb1af6aee2e0.png)

Confusion matrix of hold out set prediction

æ˜¯ä¸æ˜¯å¾ˆç‰›é€¼ï¼Ÿä¸ºäº†å®‰å…¨èµ·è§ï¼Œæˆ‘ä»¬å†æ£€æŸ¥ä¸€ä¸‹å§ï¼

## æœ€ç»ˆéªŒè¯

ä¸ºäº†è¿›ä¸€æ­¥éªŒè¯æ¨¡å‹çš„å‡†ç¡®æ€§ï¼Œæˆ‘å¦å¤–ä» Trustpilot æœé›†äº† 100 æ¡ Flixbus çš„æœ€æ–°å®¢æˆ·è¯„è®ºï¼Œå½“ç„¶è¿™äº›è¯„è®ºä¸åŒ…æ‹¬åœ¨åŸå§‹æ•°æ®é›†ä¸­ã€‚æ–°æŠ“å–çš„è¯„è®ºåŒ…æ‹¬ 1ã€4 å’Œ 5 æ˜Ÿçº§è¯„è®ºï¼Œè®¡æ•°å¦‚ä¸‹:

```
# Count of reviews per rating
Counter({1: 83, 4: 13, 5: 4})
```

ä¸ºäº†å‡†å¤‡ç”¨äºé¢„æµ‹çš„è¯„è®ºï¼Œåœ¨å°†å®ƒä»¬ä¼ é€’åˆ°è®­ç»ƒæ¨¡å‹ä¹‹å‰ï¼Œå¿…é¡»å¯¹æ–‡æœ¬åº”ç”¨ç›¸åŒçš„é¢„å¤„ç†æ­¥éª¤ã€‚

```
# Prepare reviews for check
Check_set = df.Review.values
Check_seq = tk.texts_to_sequences(Check_set)
Check_pad = pad_sequences(Check_seq, maxlen = 100, padding = 'post')# Predict sentiment
check_predict = model.predict_classes(Check_pad, verbose = 0)# Prepare data frame
check_df = pd.DataFrame(list(zip(df.Review.values, df.Rating.values, check_predict)), columns = ['Review','Rating','Sentiment'])
check_df.Sentiment = ['Pos' if x == [1] else 'Neg' for x in check_df.Sentiment]
check_df
```

æœ€åï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹ç»“æœ:

![](img/8937c8baa02f4f359ebf2513bd963cea.png)

Final check results

![](img/628aa3ecc475e51671fcbca1c936be7d.png)

Confusion matrix of validation prediction

ä»ä¸Šé¢çš„æˆªå›¾ä¸­ï¼Œæ‚¨å¯ä»¥ç«‹å³å‘ç°ä¸€äº›é”™è¯¯åˆ†ç±»çš„æƒ…å†µã€‚åœ¨ 100 ä¸ªé¢„æµ‹æ¡ˆä¾‹ä¸­ï¼Œåªæœ‰ 16 ä¸ªå®é™…è¯„çº§ä¸º 1 æ˜Ÿçš„è¯„è®ºè¢«é”™è¯¯åœ°å½’ç±»ä¸ºâ€œPosâ€(å…·æœ‰æ­£é¢æƒ…ç»ª)ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬æ·±å…¥æŒ–æ˜ï¼Œæˆ‘ä»¬ä¼šå‘ç°é—®é¢˜å®é™…ä¸Šå¹¶æ²¡æœ‰çœ‹èµ·æ¥é‚£ä¹ˆå¤§:

![](img/4752c35505604aba6965ec05259fae9b.png)

Misclassifications

16 ä¸ªæ¡ˆä¾‹ä¸­ï¼Œåªæœ‰ 3 ä¸ªç‹¬ç‰¹çš„è¯„è®ºï¼ä¸€ä¸ªè¯„è®ºé‡å¤ 14 æ¬¡(ä¸å…¬å¹³ğŸ’©).ä¸æ­¤åŒæ—¶ï¼Œæ‰€æœ‰è¯„çº§ä¸º 4 å’Œ 5 çš„å…¶ä»–äººéƒ½è¢«æ­£ç¡®åˆ†ç±»ä¸ºé˜³æ€§ã€‚

## å°±æ˜¯è¿™æ ·ï¼

å‘œå“‡ï¼æˆ‘ä»¬å·²ç»æˆåŠŸåœ°è®­ç»ƒå’ŒéªŒè¯äº† RNN çš„æƒ…æ„Ÿé¢„æµ‹æ€§èƒ½ã€‚æ€»çš„æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•å’Œå®¹æ˜“çš„ä»»åŠ¡ï¼Œäº¤ä»˜å‡ºè‰²çš„ç»“æœã€‚å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œå¹¶åŠªåŠ›å®ç°ä½ è‡ªå·±ï¼
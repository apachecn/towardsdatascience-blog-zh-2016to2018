<html>
<head>
<title>â€œCOLLABORATIVE FILTERING FROM SCRATCHâ€</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">â€œä»é›¶å¼€å§‹çš„åä½œè¿‡æ»¤â€</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://towardsdatascience.com/fast-ai-season-1-episode-5-2-collaborative-filtering-from-scratch-1877640f514a?source=collection_archive---------14-----------------------#2018-10-24">https://towardsdatascience.com/fast-ai-season-1-episode-5-2-collaborative-filtering-from-scratch-1877640f514a?source=collection_archive---------14-----------------------#2018-10-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="74aa" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">ä»å¤´å¼€å§‹æ„å»ºç”µå½±æ¨èçš„ååŒè¿‡æ»¤</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/fb87e1172ac8dd7059a16bb6837ab4dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*RL0nsiB2ntI3xooIRf6jmQ.jpeg"/></div></figure><p id="4127" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">æ¬¢è¿æ¥åˆ°ç¬¬äº”é›†<a class="ae lj" href="http://www.fast.ai/" rel="noopener ugc nofollow" target="_blank"> Fastdotai </a>çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä»é›¶å¼€å§‹è®²è¿°<strong class="kp ir">ååŒè¿‡æ»¤â€”â€”ä¸€ç§å¹¿æ³›åº”ç”¨äºæ¨èç³»ç»Ÿçš„æŠ€æœ¯</strong>ã€‚åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œæˆ‘æƒ³æ„Ÿè°¢<a class="ae lj" href="https://twitter.com/jeremyphoward" rel="noopener ugc nofollow" target="_blank"> <strong class="kp ir">ã€æ°ç‘ç±³Â·éœåå¾·ã€‘</strong> </a>å’Œ<a class="ae lj" href="https://twitter.com/math_rachel" rel="noopener ugc nofollow" target="_blank"> <strong class="kp ir">é›·åˆ‡å°”Â·æ‰˜é©¬æ–¯</strong> </a>ä¸ºæ°‘ä¸»åŒ–äººå·¥æ™ºèƒ½æ‰€åšçš„åŠªåŠ›ã€‚</p><p id="3640" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">ä¸ºäº†å……åˆ†åˆ©ç”¨è¿™ä¸ªåšå®¢ç³»åˆ—ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹é¡ºåºéšæ„æ¢ç´¢è¿™ä¸ªç³»åˆ—çš„ç¬¬ä¸€éƒ¨åˆ†</p><ol class=""><li id="4bf2" class="lk ll iq kp b kq kr kt ku kw lm la ln le lo li lp lq lr ls bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-2-1-e9cc80d81a9d">ç‹— Vs çŒ«å›¾åƒåˆ†ç±»</a></li><li id="6c08" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-2-2-dog-breed-classification-5555c0337d60">çŠ¬ç§å›¾åƒåˆ†ç±»</a></li><li id="33c2" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-3-a-case-of-multi-label-classification-a4a90672a889">å¤šæ ‡ç­¾å›¾åƒåˆ†ç±»</a></li><li id="cdb5" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-4-1-time-series-analysis-a23217418bf1">ä½¿ç”¨ç¥ç»ç½‘ç»œçš„æ—¶é—´åºåˆ—åˆ†æ</a></li><li id="f7a8" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" href="https://geneashis.medium.com/nlp-sentiment-analysis-on-imdb-movie-dataset-fb0c4d346d23" rel="noopener">IMDB ç”µå½±æ•°æ®é›†ä¸Šçš„è‡ªç„¶è¯­è¨€å¤„ç†æƒ…æ„Ÿåˆ†æ</a></li><li id="0790" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-5-1-movie-recommendation-using-fastai-a53ed8e41269">ç”µå½±æ¨èç³»ç»Ÿçš„åŸºç¡€</a></li><li id="25b8" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-5-2-collaborative-filtering-from-scratch-1877640f514a">ä»é›¶å¼€å§‹ååŒè¿‡æ»¤</a></li><li id="4481" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-5-3-collaborative-filtering-using-neural-network-48e49d7f9b36">ä½¿ç”¨ç¥ç»ç½‘ç»œçš„ååŒè¿‡æ»¤</a></li><li id="10e3" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" href="https://geneashis.medium.com/fast-ai-season-1-episode-6-1-write-philosophy-like-nietzsche-using-rnn-8fe70cfb923c" rel="noopener">åƒå°¼é‡‡ä¸€æ ·å†™å“²å­¦</a></li><li id="841f" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" href="https://geneashis.medium.com/fast-ai-season-1-episode-7-1-performance-of-different-neural-networks-on-cifar-10-dataset-c6559595b529" rel="noopener">ä¸åŒç¥ç»ç½‘ç»œåœ¨ Cifar-10 æ•°æ®é›†ä¸Šçš„æ€§èƒ½</a></li><li id="f934" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" href="https://medium.com/hackernoon/single-object-detection-e65a537a1c31" rel="noopener">æ£€æµ‹å›¾åƒä¸­æœ€å¤§ç‰©ä½“çš„ ML æ¨¡å‹ Part-1 </a></li><li id="94d1" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" href="https://medium.com/hackernoon/single-object-detection-part-2-2deafc911ce7" rel="noopener">æ£€æµ‹å›¾åƒä¸­æœ€å¤§ç‰©ä½“çš„ ML æ¨¡å‹ Part-2 </a></li></ol><p id="563d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">ç½‘é£èƒŒåçš„åŸå› å’Œå¯’æ„ã€‚</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="c5fc" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">é¦–å…ˆï¼Œè®©æˆ‘ä»¬å¯¼å…¥æ‰€æœ‰éœ€è¦çš„åŒ…ã€‚</p><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="cc78" class="mf mg iq mb b gy mh mi l mj mk">%reload_ext autoreload<br/>%autoreload 2<br/>%matplotlib inline</span><span id="b5ae" class="mf mg iq mb b gy ml mi l mj mk">from fastai.learner import *<br/>from fastai.column_data import *</span></pre><p id="93d5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">è®¾ç½®è·¯å¾„çš„ä½ç½®</p><ul class=""><li id="4a6f" class="lk ll iq kp b kq kr kt ku kw lm la ln le lo li mm lq lr ls bi translated">è¾“å…¥æ•°æ®è¢«å­˜å‚¨ã€‚</li><li id="b7fd" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li mm lq lr ls bi translated">å°†å­˜å‚¨ä¸´æ—¶æ–‡ä»¶ã€‚(å¯é€‰-åœ¨ kaggle å†…æ ¸ä¸­ä½¿ç”¨)</li><li id="9bb3" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li mm lq lr ls bi translated">æ¨¡å‹é‡é‡å°†è¢«å­˜å‚¨ã€‚(å¯é€‰-åœ¨ kaggle å†…æ ¸ä¸­ä½¿ç”¨)</li></ul><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="bcc2" class="mf mg iq mb b gy mh mi l mj mk">path='../input/'<br/>tmp_path='/kaggle/working/tmp/'<br/>models_path='/kaggle/working/models/'</span></pre><ul class=""><li id="5c4b" class="lk ll iq kp b kq kr kt ku kw lm la ln le lo li mm lq lr ls bi translated">æ•°æ®çš„è¯»å–ã€‚</li></ul><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="3233" class="mf mg iq mb b gy mh mi l mj mk">ratings = pd.read_csv(path+'ratings.csv')<br/>ratings.head()<br/># This contains the userid , the movie that the userid watched , the time that movie has been watched , the ratings that has provided by the user .</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mn"><img src="../Images/4e0fa89868273e0a19138e8384c77750.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*-zd8HFQHTWbOEXtGanvk0Q.png"/></div></div></figure><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="34ba" class="mf mg iq mb b gy mh mi l mj mk">movies = pd.read_csv(path+'movies.csv')<br/>movies.head()<br/># This table is just for information purpose and not intended for         # modelling purpose</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/ba816f35341110482f3c34d6a5adc4a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*wquV6nC2fwUgVMjBmT7g4A.png"/></div></figure><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="d4b6" class="mf mg iq mb b gy mh mi l mj mk">u_uniq = ratings.userId.unique() <br/>user2idx = {o:i for i,o in enumerate(u_uniq)}<br/># Take every unique user id and map it to a contiguous user .<br/>ratings.userId = ratings.userId.apply(lambda x: user2idx[x])<br/># Replace that userid with contiguous number.</span><span id="5059" class="mf mg iq mb b gy ml mi l mj mk"># Similarly, we do it for the movies. <br/>m_uniq = ratings.movieId.unique()<br/>movie2idx = {o:i for i,o in enumerate(m_uniq)}<br/>ratings.movieId = ratings.movieId.apply(lambda x: movie2idx[x])<br/></span></pre><p id="2306" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">å°† movieId å’Œ userId è½¬æ¢æˆè¿ç»­çš„æ•´æ•°æœ‰åŠ©äºæˆ‘ä»¬å†³å®šåµŒå…¥çŸ©é˜µã€‚è¿™äº› userId å’Œ movieID çš„å€¼åœ¨å¼€å§‹æ—¶ä¸è¿ç»­ã€‚å®ƒå¯èƒ½ä» 100 ä¸‡å¼€å§‹ï¼Œå¹¶ä¸”ä¸ä¼šæ˜¯è¿ç»­çš„ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨è¿™äº›å€¼æ¥å†³å®šæˆ‘ä»¬çš„åµŒå…¥çŸ©é˜µï¼Œé‚£ä¹ˆåµŒå…¥çŸ©é˜µçš„å¤§å°å°†ä¼šå¤ªå¤§ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ç¼“æ…¢çš„å¤„ç†æˆ–è¿‡æ‹Ÿåˆã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/c4222c3c56db7fc06ac41937df7c2ac7.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*97-tdnBwqO0kh__4xC-ymQ.png"/></div></figure><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="ebe3" class="mf mg iq mb b gy mh mi l mj mk">class EmbeddingDot(nn.Module):<br/>    def __init__(self, n_users, n_movies):<br/>        super().__init__()<br/>        self.u = nn.Embedding(n_users, n_factors)<br/>        self.m = nn.Embedding(n_movies, n_factors)<br/>        self.u.weight.data.uniform_(0,0.05)<br/>        self.m.weight.data.uniform_(0,0.05)<br/>        <br/>    def forward(self, cats, conts):<br/>        users,movies = cats[:,0],cats[:,1]<br/>        u,m = self.u(users),self.m(movies)<br/>        return (u*m).sum(1).view(-1, 1)</span><span id="5cbd" class="mf mg iq mb b gy ml mi l mj mk">model = EmbeddingDot(n_users, n_movies).cuda() # Class Instantiation</span></pre><p id="7e7f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">ä¸Šè¿°ä»£ç ä¸­æ¶‰åŠåˆ° OOPs çš„æ¦‚å¿µã€‚æ‰€ä»¥æˆ‘æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ã€‚</p><ul class=""><li id="c256" class="lk ll iq kp b kq kr kt ku kw lm la ln le lo li mm lq lr ls bi translated"><code class="fe mu mv mw mb b">self </code>æ˜¯ä¸€ä¸ªå‚è€ƒå˜é‡ï¼Œå½“å¯¹è±¡(å³æ¨¡å‹)è¢«åˆ›å»ºæ—¶ï¼Œå­˜å‚¨è¯¥å¯¹è±¡ã€‚</li><li id="0db3" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li mm lq lr ls bi translated"><code class="fe mu mv mw mb b">def __init__(self, n_users, n_movies):</code>æ˜¯ä¸€ä¸ªç¥å¥‡çš„åŠŸèƒ½ã€‚æ¯å½“ä¸ºè¯¥ç±»åˆ›å»ºå¯¹è±¡æ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒã€‚è¿™ç§ç±»å‹çš„å‡½æ•°è¢«ç§°ä¸ºæ„é€ å‡½æ•°ã€‚</li><li id="c44a" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li mm lq lr ls bi translated"><code class="fe mu mv mw mb b">model = EmbeddingDot(n_users, n_movies).cuda()</code>ã€‚è¿™é‡Œåˆ›å»ºäº†å¯¹è±¡ã€‚éšç€å®ƒçš„åˆ›å»ºï¼Œæ„é€ å‡½æ•°è¢«è‡ªåŠ¨è°ƒç”¨ã€‚</li><li id="b53b" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li mm lq lr ls bi translated">ä½†æ˜¯ç‰©ä½“æ˜¯ä»€ä¹ˆï¼Ÿä¸€ä¸ªå¯¹è±¡(å³æ¨¡å‹)æ˜¯ä¸€ä¸ªå…·æœ‰ä¸€äº›å±æ€§å’Œè¡Œä¸ºçš„å®ä½“ã€‚</li><li id="db8d" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li mm lq lr ls bi translated">è¿™äº›è¡Œä¸ºæ˜¯åµŒå…¥çš„å½¢çŠ¶å’Œå€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</li></ul><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="fc83" class="mf mg iq mb b gy mh mi l mj mk">self.u = nn.Embedding(n_users, n_factors) # User Embeddings<br/>self.m = nn.Embedding(n_movies, n_factors) # Movie Embeddings<br/>self.u.weight.data.uniform_(0,0.05) # Values for User Embeddings<br/>self.m.weight.data.uniform_(0,0.05) # Values for Movie Embeddings</span></pre><ul class=""><li id="6351" class="lk ll iq kp b kq kr kt ku kw lm la ln le lo li mm lq lr ls bi translated">ä¸ºäº†è·å¾—è¿™äº›åµŒå…¥çš„å€¼ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä»<code class="fe mu mv mw mb b">nn.Module </code>ç»§æ‰¿è€Œæ¥çš„<code class="fe mu mv mw mb b">nn.Embedding </code>ï¼Œä½¿ç”¨äº† OOP çš„<code class="fe mu mv mw mb b">Inheritance </code>æ¦‚å¿µï¼Œä½¿ç”¨äº†ä¸‹é¢è¿™è¡Œä»£ç :- <code class="fe mu mv mw mb b">super().__init__()</code>ã€‚</li><li id="5814" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li mm lq lr ls bi translated"><code class="fe mu mv mw mb b">self.u</code>è®¾ç½®ä¸ºåµŒå…¥ç±»çš„å®ä¾‹ã€‚å®ƒæœ‰ä¸€ä¸ªåŒ…å«å®é™…åµŒå…¥çŸ©é˜µçš„<code class="fe mu mv mw mb b"> .weight</code>å±æ€§ã€‚åµŒå…¥çŸ©é˜µæ˜¯ä¸€ä¸ªå˜é‡ã€‚å˜é‡å’Œå¼ é‡ä¸€æ ·ï¼Œå®ƒä¼šè‡ªåŠ¨å¾®åˆ†ã€‚</li><li id="333b" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li mm lq lr ls bi translated">è¦è®¿é—®å¼ é‡ä½¿ç”¨ï¼Œ<code class="fe mu mv mw mb b">self.u.weight.data</code>å±æ€§ã€‚</li><li id="e181" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li mm lq lr ls bi translated"><code class="fe mu mv mw mb b">self.u.weight.data.uniform_</code> :-æœ«å°¾çš„ä¸‹åˆ’çº¿ç¬¦å·è¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå°±åœ°æ“ä½œã€‚<code class="fe mu mv mw mb b">self.u.weight.data.uniform_</code>è¡¨ç¤ºè¿™ä¸ªå¼ é‡çš„é€‚å½“å¤§å°çš„å‡åŒ€éšæœºæ•°ï¼Œä¸è¿”å›å®ƒï¼Œè€Œæ˜¯åœ¨é€‚å½“çš„ä½ç½®å¡«å……çŸ©é˜µã€‚</li><li id="acd0" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li mm lq lr ls bi translated">å½“æˆ‘ä»¬ç¨åè¿›è¡Œæ‹Ÿåˆæ—¶ï¼Œå‰è¿›åŠŸèƒ½å¼€å§‹èµ·ä½œç”¨ã€‚ä½†æ˜¯ï¼Œè®©æˆ‘ä»¬æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹å½“è°ƒç”¨ forward å‡½æ•°æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</li></ul><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="adbd" class="mf mg iq mb b gy mh mi l mj mk">def forward(self, cats, conts):<br/>        users,movies = cats[:,0],cats[:,1]<br/>        u,m = self.u(users),self.m(movies)<br/>        return (u*m).sum(1).view(-1, 1)</span></pre><ul class=""><li id="d7c3" class="lk ll iq kp b kq kr kt ku kw lm la ln le lo li mm lq lr ls bi translated"><code class="fe mu mv mw mb b">users,movies = cats[:,0],cats[:,1]</code> :-æŠ“å–ç”¨æˆ·å’Œç”µå½±çš„è¿·ä½ æ‰¹æ¬¡ã€‚</li><li id="623e" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li mm lq lr ls bi translated"><code class="fe mu mv mw mb b">u,m = self.u(users),self.m(movies)</code> :-å¯¹äºå°æ‰¹é‡çš„ç”¨æˆ·å’Œç”µå½±ï¼Œä½¿ç”¨<code class="fe mu mv mw mb b">self.u(users),self.m(movies)</code>æŸ¥æ‰¾ç”¨æˆ·å’Œç”µå½±çš„åµŒå…¥çŸ©é˜µã€‚</li><li id="73ff" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li mm lq lr ls bi translated">åœ¨å¾—åˆ°ç”¨æˆ·å’Œç”µå½±çš„åµŒå…¥åï¼Œæˆ‘ä»¬å°†è¿™ä¸¤è€…è¿›è¡Œå‰ç§¯ï¼Œå¾—åˆ°ä¸€ä¸ªæ•°å­—ï¼Œè¿™å°±æ˜¯é¢„æµ‹çš„æ”¶è§†ç‡ã€‚</li></ul><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="15b0" class="mf mg iq mb b gy mh mi l mj mk">x = ratings.drop(['rating', 'timestamp'],axis=1)<br/># The x contain movies and users from the dataframe. Independent     # variables.</span><span id="ba8d" class="mf mg iq mb b gy ml mi l mj mk">y = ratings['rating'].astype(np.float32)<br/># The y contains the dependent Variable i.e the ratings.</span><span id="08ff" class="mf mg iq mb b gy ml mi l mj mk">data = ColumnarModelData.from_data_frame(path, val_idxs, x, y, ['userId', 'movieId'], 64)</span><span id="1ee3" class="mf mg iq mb b gy ml mi l mj mk">1# path :- path of the file.<br/>2# val_idxs :- Validation data<br/>3# x, y :- Described above as independent and dependent variable.<br/>4# ['userId', 'movieId'] :- List of categorical variables.<br/>5# 64 :- batch size.</span><span id="151c" class="mf mg iq mb b gy ml mi l mj mk">wd=1e-5 # Regularization parameter<br/><br/>opt = optim.SGD(model.parameters(), 1e-1, weight_decay=wd, momentum=0.9)<br/># Optimizer to be used to update the weights or model.parameters().<br/># model.parameters() is derived from nn.Module which gives list of all   # the weights that are needed to be updated and hence passed to optimizer # along with learning rate, weight decay and momentum.</span></pre><p id="5f32" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">ä¸ºäº†æ‹Ÿåˆæˆ‘ä»¬çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸ºäº†è®­ç»ƒï¼Œæ—©å…ˆæˆ‘ä»¬ä½¿ç”¨äº†<code class="fe mu mv mw mb b">learner</code>ï¼Œå®ƒæ˜¯ fast.ai çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨ PyTorch åŠŸèƒ½ã€‚å½“æ‰§è¡Œä¸‹é¢çš„<code class="fe mu mv mw mb b">fit </code>å‘½ä»¤æ—¶ï¼Œæ£€æŸ¥ fastai æ–‡ä»¶å¤¹ä¸­çš„<code class="fe mu mv mw mb b">model.py </code>æ–‡ä»¶ï¼Œä»¥äº†è§£ fit å‘½ä»¤çš„åº•å±‚ã€‚åŸºæœ¬ä¸Šå®ƒåšçš„æ˜¯:-</p><ul class=""><li id="5a2f" class="lk ll iq kp b kq kr kt ku kw lm la ln le lo li mm lq lr ls bi translated">é€šè¿‡è°ƒç”¨æ­£å‘å‡½æ•°<code class="fe mu mv mw mb b">def forward(self, cats, conts):</code>è¿›è¡Œæ­£å‘ä¼ é€’</li><li id="da4d" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li mm lq lr ls bi translated">ä»¥åŠæ›´æ–°åµŒå…¥çš„åå‘ä¼ é€’ï¼Œè¿™æ˜¯ PyTorch çš„åŠŸèƒ½ã€‚</li></ul><p id="ef00" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><code class="fe mu mv mw mb b">fit(model, data, 3, opt, F.mse_loss)</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/2dd0d8a97bd5f24193433358df02b620.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*AIsAiz4LhqC29TZxv6JAxA.png"/></div></figure><p id="a3f2" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">è¿™é‡Œæˆ‘ä»¬ä¸ä¼šå¾—åˆ° SGDR çš„åŠŸèƒ½ï¼Œå› æ­¤æ‰‹åŠ¨é‡ç½®å­¦ä¹ ç‡ï¼Œå¹¶æ£€æŸ¥æŸå¤±ã€‚</p><p id="bf54" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><code class="fe mu mv mw mb b">set_lrs(opt, 0.01)</code></p><p id="894a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><code class="fe mu mv mw mb b">fit(model, data, 3, opt, F.mse_loss)</code></p><p id="6bb1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">è™½ç„¶æˆ‘ä»¬çš„æ¨¡å‹è¡¨ç°è‰¯å¥½ï¼Œä½†ç”±äºæˆ‘ä»¬æ²¡æœ‰æ­£ç¡®å®æ–½ SGDRï¼Œå› æ­¤æˆ‘ä»¬çš„æŸå¤±æ¯”ä»¥å‰æ›´é«˜ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi my"><img src="../Images/d40a67191e7aa66fb518f69f1630c842.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/1*LAgArKFpbApDRJDA_pkEGg.png"/></div></figure><p id="31e4" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">å¦‚ä½•è¿›ä¸€æ­¥å®Œå–„æ¨¡å‹ï¼Ÿï¼Ÿ</strong></p><p id="a321" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">ç°åœ¨æˆ‘ä»¬å°†è€ƒè™‘åè§ã€‚ä¼šæœ‰ä¸€äº›ç”¨æˆ·éå¸¸çƒ­æƒ…ï¼Œå¹³å‡æ¥è¯´ä¼šç»™æ‰€æœ‰çš„ç”µå½±æ›´é«˜çš„è¯„ä»·ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ä¸ºç”µå½±å’Œç”¨æˆ·æ·»åŠ ä¸€ä¸ªå¸¸é‡ã€‚è¿™ä¸ªå¸¸æ•°è¢«ç§°ä¸ºåå·®ã€‚</p><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="d4b2" class="mf mg iq mb b gy mh mi l mj mk">min_rating,max_rating = ratings.rating.min(),ratings.rating.max()<br/>min_rating,max_rating</span><span id="9e7c" class="mf mg iq mb b gy ml mi l mj mk">def get_emb(ni,nf): <br/># Input is #User,#Factors i.e Embedding Dimensionality<br/>    e = nn.Embedding(ni, nf) # Creation of Embedding matrix<br/>    e.weight.data.uniform_(-0.01,0.01)<br/> # Fill it with randomly initialized values between (-0.01,0.01)<br/>    return e</span><span id="0e1c" class="mf mg iq mb b gy ml mi l mj mk">class EmbeddingDotBias(nn.Module):<br/>    def __init__(self, n_users, n_movies):<br/>        super().__init__()<br/># Creating an embedding for User (self.u) , Movies (self.m), <br/># User bias (self.ub), Movie bias (self.mb) by calling get_emb().</span><span id="f23b" class="mf mg iq mb b gy ml mi l mj mk">(self.u, self.m, self.ub, self.mb) = [get_emb(*o) for o in [<br/>            (n_users, n_factors), (n_movies, n_factors), (n_users,1), (n_movies,1)<br/>        ]]<br/>        <br/>    def forward(self, cats, conts):<br/>        users,movies = cats[:,0],cats[:,1]<br/>        um = (self.u(users)* self.m(movies)).sum(1)<br/>        res = um + self.ub(users).squeeze() + self.mb(movies).squeeze()<br/># Add in user bias and movie bias. Using .squeeze() does a broadcasting.</span><span id="9c63" class="mf mg iq mb b gy ml mi l mj mk">        res = F.sigmoid(res) * (max_rating-min_rating) + min_rating<br/># This is gonna squish the value between 1 and 5 . What it does is if its # a good movie then it will get a really high number else a low number.<br/>#  F.sigmoid(res) is gonna squish it between 0 and 1.</span><span id="4747" class="mf mg iq mb b gy ml mi l mj mk"><br/>        return res.view(-1, 1)</span><span id="c05c" class="mf mg iq mb b gy ml mi l mj mk">wd=2e-4<br/>model = EmbeddingDotBias(cf.n_users, cf.n_items).cuda()<br/>opt = optim.SGD(model.parameters(), 1e-1, weight_decay=wd, momentum=0.9)<br/>fit(model, data, 3, opt, F.mse_loss)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/1fbf1b25f25c3d4a01c36b391676d12a.png" data-original-src="https://miro.medium.com/v2/resize:fit:574/format:webp/1*czmce2kZbX48z8danvOa0w.png"/></div></figure><pre class="kg kh ki kj gt ma mb mc md aw me bi"><span id="8f9d" class="mf mg iq mb b gy mh mi l mj mk">set_lrs(opt, 1e-2)<br/>fit(model, data, 3, opt, F.mse_loss)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi na"><img src="../Images/6ce6e8e629eddd4dd9cb7685add70270.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*D6F1I52yn-wM3j4Ld1tXdA.png"/></div></figure><p id="9209" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">æœ€åï¼Œæˆ‘ä»¬è¾¾åˆ°äº† 0.8 çš„æŸå¤±ï¼Œè¿™ç›¸å½“ä¸é”™ã€‚</p><p id="26b0" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="nb">å¦‚æœä½ å–œæ¬¢ï¼Œé‚£ä¹ˆ</em><strong class="kp ir"><em class="nb">ABC</em></strong><em class="nb">(</em><strong class="kp ir"><em class="nb">æ°¸è¿œè¢«å‡»èŠ‚</em> </strong> <em class="nb">ã€‚</em> <strong class="kp ir"> <em class="nb">ğŸ‘ ğŸ‘ğŸ‘ğŸ‘ğŸ‘</em>ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ<em class="nb">ğŸ‘ ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘</em> </strong> <em class="nb"> ) </em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc lz l"/></div></figure><p id="d488" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶è”ç³»<a class="ae lj" href="http://forums.fast.ai/" rel="noopener ugc nofollow" target="_blank"> fast.ai è®ºå›</a>æˆ– Twitter:<a class="ae lj" href="https://twitter.com/ashiskumarpanda" rel="noopener ugc nofollow" target="_blank">@ ashiskumarpanda</a></p><p id="4325" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">æ³¨:éšç€æˆ‘ç»§ç»­å­¦ä¹ å…¶ä»–è¯¾ç¨‹ï¼Œè¿™ç¯‡åšæ–‡å°†ä¼šæ›´æ–°å’Œæ”¹è¿›ã€‚æ›´å¤šæœ‰è¶£çš„ä¸œè¥¿ï¼Œå¯ä»¥éšæ—¶æŸ¥çœ‹æˆ‘çš„<a class="ae lj" href="https://github.com/CaptainAshis" rel="noopener ugc nofollow" target="_blank"><em class="nb">Github</em></a><em class="nb">è´¦å·ã€‚</em></p><p id="5076" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">ä¸ºäº†å……åˆ†åˆ©ç”¨è¿™ä¸ªåšå®¢ç³»åˆ—ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹é¡ºåºéšæ„æ¢ç´¢è¿™ä¸ªç³»åˆ—çš„ç¬¬ä¸€éƒ¨åˆ†:- <a class="ae lj" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-2-1-e9cc80d81a9d">ç‹—ä¸çŒ«çš„å›¾åƒåˆ†ç±»</a></p><ol class=""><li id="3c15" class="lk ll iq kp b kq kr kt ku kw lm la ln le lo li lp lq lr ls bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-2-2-dog-breed-classification-5555c0337d60">çŠ¬ç§å›¾åƒåˆ†ç±»</a></li><li id="ec86" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-3-a-case-of-multi-label-classification-a4a90672a889">å¤šæ ‡ç­¾å›¾åƒåˆ†ç±»</a></li><li id="2e1f" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-4-1-time-series-analysis-a23217418bf1">ä½¿ç”¨ç¥ç»ç½‘ç»œçš„æ—¶é—´åºåˆ—åˆ†æ</a></li><li id="67d4" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" href="https://geneashis.medium.com/nlp-sentiment-analysis-on-imdb-movie-dataset-fb0c4d346d23" rel="noopener">å¯¹ IMDB ç”µå½±æ•°æ®é›†çš„ NLP æƒ…æ„Ÿåˆ†æ</a></li><li id="5e9c" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-5-1-movie-recommendation-using-fastai-a53ed8e41269">ç”µå½±æ¨èç³»ç»Ÿçš„åŸºç¡€</a></li><li id="5574" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-5-2-collaborative-filtering-from-scratch-1877640f514a">ä»é›¶å¼€å§‹ååŒè¿‡æ»¤</a></li><li id="2f82" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" rel="noopener" target="_blank" href="/fast-ai-season-1-episode-5-3-collaborative-filtering-using-neural-network-48e49d7f9b36">ä½¿ç”¨ç¥ç»ç½‘ç»œçš„ååŒè¿‡æ»¤</a></li><li id="6c67" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" href="https://geneashis.medium.com/fast-ai-season-1-episode-6-1-write-philosophy-like-nietzsche-using-rnn-8fe70cfb923c" rel="noopener">åƒå°¼é‡‡ä¸€æ ·å†™å“²å­¦</a></li><li id="a3d1" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" href="https://geneashis.medium.com/fast-ai-season-1-episode-7-1-performance-of-different-neural-networks-on-cifar-10-dataset-c6559595b529" rel="noopener">ä¸åŒç¥ç»ç½‘ç»œåœ¨ Cifar-10 æ•°æ®é›†ä¸Šçš„æ€§èƒ½</a></li><li id="61ac" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" href="https://medium.com/hackernoon/single-object-detection-e65a537a1c31" rel="noopener"> ML æ¨¡å‹æ£€æµ‹å›¾åƒä¸­æœ€å¤§çš„ç‰©ä½“ Part-1 </a></li><li id="241a" class="lk ll iq kp b kq lt kt lu kw lv la lw le lx li lp lq lr ls bi translated"><a class="ae lj" href="https://medium.com/hackernoon/single-object-detection-part-2-2deafc911ce7" rel="noopener"> ML æ¨¡å‹æ£€æµ‹å›¾åƒä¸­æœ€å¤§çš„ç‰©ä½“ Part-2 </a></li></ol><p id="b679" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">ç¼–è¾‘ 1:-TFWÂ·æ°ç‘ç±³Â·éœåå¾·åŒæ„ä½ çš„å¸–å­ã€‚ğŸ’–ğŸ’– ğŸ™ŒğŸ™ŒğŸ™Œ ğŸ’–ğŸ’–ã€‚</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd lz l"/></div></figure></div></div>    
</body>
</html>
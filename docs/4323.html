<html>
<head>
<title>Visualizing Japan cherry blossom season forecast 2018 â€” doing it all in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¯è§†åŒ– 2018 å¹´æ—¥æœ¬æ¨±èŠ±å­£é¢„æµ‹â€”â€”å°½åœ¨ R</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://towardsdatascience.com/visualizing-japan-cherry-blossom-season-forecast-2018-doing-it-all-in-r-8b0ef46a6762?source=collection_archive---------14-----------------------#2018-08-07">https://towardsdatascience.com/visualizing-japan-cherry-blossom-season-forecast-2018-doing-it-all-in-r-8b0ef46a6762?source=collection_archive---------14-----------------------#2018-08-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0755" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¦ä¸€ç§ç”¨äºæ•™è‚²ç›®çš„çš„åŠ¨ç”»æ•°æ®å¯è§†åŒ–ä½“éªŒï¼Œåˆ©ç”¨ FFmpeg å°†å›¾åƒè½¬æ¢ä¸º MP4</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/88adae805ddfc30b073ed265aa4aea4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qi7b2rY6eGJ-y8kOLHIYSA.jpeg"/></div></div></figure><p id="8a1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æœ€è¿‘ï¼Œæˆ‘æ€€ç€æ— æ¯”çš„å–œæ‚¦ç¬¬ä¸€æ¬¡è®¿é—®äº†æ—¥æœ¬ã€‚è¿™æ¬¡æ—…è¡Œæ˜¯å¯¹æ—¥æœ¬ç¾ä¸½è¿·äººçš„é£æ™¯ã€å†å²å’Œä¸°å¯Œæ–‡åŒ–çš„å®Œç¾ä»‹ç»ã€‚æˆ‘éå¸¸æ€€å¿µçš„ä¸€ä»¶äº‹æ˜¯èƒ½å¤Ÿçœ‹åˆ°æ¨±èŠ±ã€‚æ‰€ä»¥æˆ‘å†³å®šæŠŠå®ƒä½œä¸ºè¿™æ¬¡å¯è§†åŒ–çš„ä¸»é¢˜ã€‚</p><p id="bba4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å››å¤„å¯»æ‰¾æ•°æ®é›†(æœ€å¥½æ˜¯å¸¦æ—¥æœŸçš„ geojson)ï¼Œä¸å¹¸çš„æ˜¯æ²¡æœ‰è¿™æ ·çš„å¯ç”¨æ•°æ®é›†ã€‚</p><p id="5af3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ²¡é—®é¢˜ã€‚æˆ‘å†³å®šä» 2018 å¹´ JR é“è·¯é€šè¡Œè¯çš„<a class="ae kx" href="https://www.jrailpass.com/blog/japan-cherry-blossom-forecast" rel="noopener ugc nofollow" target="_blank">å®˜æ–¹é¢„æŠ¥ç½‘é¡µ</a>å»ºç«‹ä¸€ä¸ªç®€å•çš„ç½‘ç»œæŠ“å–ã€‚å®ƒåŒ…æ‹¬ä¸‹è½½ä¸€ä¸ªè¡¨ï¼Œç„¶åå°†è¯¥è¡¨æ˜ å°„åˆ°æ—¥æœ¬åœ°åŒºçš„åç§°ã€‚æœ‰ä¸€äº›å¿…è¦çš„æ•°æ®æ¸…ç†æ“ä½œï¼Œä»¥ç¡®å®šå¼€èŠ±ã€å®Œå…¨å¼€èŠ±å’ŒèŠ±æœŸç»“æŸã€‚å¹¸è¿çš„æ˜¯ï¼Œå®˜æ–¹é¢„æŠ¥ç½‘é¡µç»™äº†æˆ‘æ‰€éœ€çš„å¼€èŠ±å‰ 1 å‘¨å’Œå¼€èŠ±å 1 å‘¨çš„å‡è®¾:</p><blockquote class="ky kz la"><p id="a938" class="jn jo lb jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated">â€œè¯·è®°ä½ï¼Œ<strong class="jp ir">å¤§å¤šæ•°èŠ±ä¸€æ—¦å¼€å§‹å¼€èŠ±ï¼Œé€šå¸¸éœ€è¦ä¸€å‘¨çš„æ—¶é—´è¾¾åˆ°ç››å¼€</strong>ï¼Œè€Œ<strong class="jp ir">çš„ç››å¼€ä¹Ÿè¦æŒç»­ä¸€å‘¨å·¦å³â€(JR é“è·¯é€šè¡Œè¯åšå®¢)</strong></p></blockquote><p id="398c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸‹é¢æ˜¯æˆ‘ä»¬å°†æ„å»ºçš„ä½“éªŒçš„ç»“æœã€‚</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/053899271d5c24925e62e1bb16b8bac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*g7hwQMBVfScv5qMOZt9YUQ.gif"/></div></figure><p id="4e84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™ç§æ–¹æ³•ä¸ä½¿ç”¨ä»»ä½•åº“ã€‚ç›®æ ‡æ˜¯å¸®åŠ©äººä»¬æ›´å¥½åœ°ç†è§£å¹•åå‘ç”Ÿçš„äº‹æƒ…ã€‚ç”µå½±æ˜¯ä¸€ç³»åˆ—é™æ­¢çš„å›¾åƒï¼Œå½“ä¸€ä¸ªå›¾åƒä¸€ä¸ªå›¾åƒåœ°æ’­æ”¾æ—¶ï¼Œä¼šäº§ç”Ÿè¿åŠ¨çš„é”™è§‰ã€‚æœ¬æ•™ç¨‹å°†é€šè¿‡ç”Ÿæˆ 55 å¼ å›¾ç‰‡(æ¯å¤©ä¸€å¼ )æ¥åšåŒæ ·çš„äº‹æƒ…ï¼Œå¹¶å°†ä½¿ç”¨ FFmpeg å°†å®ƒä»¬è½¬æ¢æˆä¸€éƒ¨ç”µå½±(2 è¡Œä»£ç )ã€‚</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/61b2b3134324e7d2dfca3232a7f7e841.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/0*IJIsw9in4IZ4Wld2.gif"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk">Sallie Gardner at a Gallop â€” made by Eadweard Muybridge in 1878</figcaption></figure><h1 id="7c95" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">ä½¿ç”¨ R:</h1><p id="30f3" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">æˆ‘ä»¬å°†è·³è¿‡æ­¥éª¤ 0 (webscraping å’Œæ•°æ®æ¸…ç†ä»¥åˆ›å»ºæ•°æ®é›†),ä¸“æ³¨äºæ­¥éª¤ 1 åˆ° 3â€”â€”åŠ è½½æ–‡ä»¶ã€ç”Ÿæˆå›¾åƒå¹¶å°†å…¶è½¬æ¢ä¸ºç”µå½±ã€‚</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mo"><img src="../Images/cd56a65cdd2b9c0c2f77d64626fc9e89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kf3fxoBBeaAVimNFVBHwhg.png"/></div></div></figure><p id="bcbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">æ­¥éª¤ 1â€”â€”åŠ è½½å¹¶å‡†å¤‡æ–‡ä»¶</strong></p><p id="8b24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬å°†ä½¿ç”¨ 2 ä¸ªæ–‡ä»¶:1)ä» JR é“è·¯é€šé“è·å¾—çš„æ•°æ®é›†å’Œæ¥è‡ªæ—¥æœ¬çš„ Geojson æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒä»¬è½¬æ¢æˆå¸¦æœ‰æ¯ä¸ªåœ°åŒºåç§°çš„æ•°æ®å¸§ã€‚</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="a99e" class="mu lm iq mq b gy mv mw l mx my">#Step 1 - Loading datasets<br/>myurl&lt;-'<a class="ae kx" href="https://raw.githubusercontent.com/tristanga/Visualizing-Japan-cherry-blossom-season-forecast-2018/master/sakura_2018.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/tristanga/Visualizing-Japan-cherry-blossom-season-forecast-2018/master/sakura_2018.csv</a><a class="ae kx" href="https://raw.githubusercontent.com/tristanga/Visualizing-Japan-cherry-blossom-season-forecast-2018/master/sakura_2018.csv'" rel="noopener ugc nofollow" target="_blank">'</a><br/>sakuradf&lt;- read.csv(myurl)<br/>sakuradf$sakura &lt;- as.factor(sakuradf$sakura)</span><span id="8c45" class="mu lm iq mq b gy mz mw l mx my">#Loading geojson Japan map and convert it into dataframe<br/>myurl &lt;- '<a class="ae kx" href="https://raw.githubusercontent.com/tristanga/Visualizing-Japan-cherry-blossom-season-forecast-2018/master/Japan.json" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/tristanga/Visualizing-Japan-cherry-blossom-season-forecast-2018/master/Japan.json</a><a class="ae kx" href="https://raw.githubusercontent.com/tristanga/Visualizing-Japan-cherry-blossom-season-forecast-2018/master/Japan.json'" rel="noopener ugc nofollow" target="_blank">'</a><br/>map_japan &lt;- geojson_read(myurl,  what = "sp")<br/>map_japan.df &lt;- fortify(map_japan)</span><span id="8f94" class="mu lm iq mq b gy mz mw l mx my">#Adding the name to the region<br/>myid &lt;- as.data.frame(map_japan@data)<br/>myid$id &lt;- seq.int(nrow(myid))-1<br/>myid &lt;- myid  %&gt;% select(id, name)<br/>map_japan.df &lt;- merge(map_japan.df, myid,  by.x="id", by.y="id")</span></pre><p id="548e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">æ­¥éª¤ 2 â€”ç”Ÿæˆ 55 å¹…å›¾åƒ</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi na"><img src="../Images/e11fa382a52c6adfcee3918862b302cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x_U53fMxLlvAVmU5Mgrrig.png"/></div></div></figure><p id="1210" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬é¦–å…ˆå¿…é¡»åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰å”¯ä¸€æ—¥æœŸçš„è¿‡æ»¤å™¨ã€‚ç”±äºåƒå†²ç»³è¿™æ ·çš„ä¸€äº›åœ°åŒºåœ¨ä½¿ç”¨çš„ geojson åœ°å›¾ä¸Šçœ‹ä¸å¤ªæ¸…æ¥šï¼Œæ‰€ä»¥æœ€å¥½ä»æ¨±èŠ±é¢„æµ‹çš„ç¬¬ 65 å¤©å¼€å§‹ä¸€ç›´åˆ°ç»“æŸï¼Œè€Œä¸æ˜¯ç¬¬ 1 å¤©ã€‚</p><p id="c8a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¦ä» ggplot è·å¾—æ›´å¥½çš„ç»“æœï¼Œéœ€è¦ ggplot çš„ä¸»é¢˜(å‚è§ theme_map)ã€‚</p><p id="67f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç„¶åï¼Œä»ç¬¬ 65 å¤©åˆ°æœ€ååˆ›å»ºä¸€ä¸ªç®€å•çš„å¾ªç¯ï¼Œè¿‡æ»¤å½“å¤©çš„å†…å®¹å¹¶ä¸ JSON åˆå¹¶ï¼Œç„¶åå°†å›¾åƒä¿å­˜åˆ°åœ°å›¾æ–‡ä»¶å¤¹ä¸­ã€‚</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="2c78" class="mu lm iq mq b gy mv mw l mx my">#Step 2 - Generating 55 images</span><span id="6553" class="mu lm iq mq b gy mz mw l mx my">#Creating a filter of all the dates<br/>mydates =unique(sakuradf$date)</span><span id="0f7e" class="mu lm iq mq b gy mz mw l mx my">#Displaying only the last 55 days of the season (skipping Okinawa region)<br/>startdate = 65<br/>enddate = length(mydates)</span><span id="5a8c" class="mu lm iq mq b gy mz mw l mx my">#Generating a style<br/>theme_map &lt;- function(base_size = 12) {<br/>  theme_minimal() +<br/>    theme(<br/>      axis.line = element_blank(),<br/>      axis.text.x = element_blank(),<br/>      axis.text.y = element_blank(),<br/>      axis.ticks = element_blank(),<br/>      axis.title.x = element_blank(),<br/>      axis.title.y = element_blank(),<br/>      # panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),<br/>      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),<br/>      panel.grid.minor = element_blank(),<br/>      plot.background = element_rect(fill = "#f5f5f2", color = NA), <br/>      panel.background = element_rect(fill = "#f5f5f2", color = NA), <br/>      legend.position = 'None', legend.title = element_blank(),<br/>      panel.border = element_blank()<br/>    )<br/>}</span><span id="d757" class="mu lm iq mq b gy mz mw l mx my">#Creating a loop to filter on each day, generate a chart and saving 55 images in a map folder<br/>for (x in startdate:enddate){<br/>  my_x = mydates[x]<br/>  print(paste("The year is", my_x))<br/>  sakuradf_x &lt;- sakuradf %&gt;% filter(date == my_x)<br/>  map_japan.df_x &lt;- merge(map_japan.df, sakuradf_x,  by.x="name", by.y="name")<br/>  japanplot &lt;- ggplot(map_japan.df_x) +<br/>    geom_polygon(aes(x = long, y = lat, fill = sakura, group = group)) +<br/>    theme_map()+scale_fill_manual(values=c("4"='#d2618c',"3"='#e3adcb' , "2"="#f7e0f4", "1"="#9db6c7")) +<br/>    ylim(30,46)+ <br/>    xlim(127,148)+ <br/>    labs(x = NULL, <br/>         y = NULL, <br/>         title = "Japan Sakura Seasons", <br/>         subtitle = paste("Date: ", my_x, sep=""),<br/>         caption = "Japan Weather Forecast 2018")<br/>  filename &lt;- paste0("maps/img_" , str_pad(x-64, 7, pad = "0"),  ".png")<br/>  ggsave(filename = filename, plot = japanplot, width = 5, height = 5, dpi = 150, type = "cairo-png")<br/>}</span></pre><p id="0df9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">æ­¥éª¤ 3 â€”ä»å›¾åƒåˆ°ç”µå½±</strong></p><p id="14f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åªè¦ä½ ä¸‹è½½äº† FFmeg å¹¶è§£å‹åˆ°æœ¬åœ°æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ C:/ffmpegï¼Œåªéœ€è¦ç®€å•çš„å‡ è¡Œä»£ç å°±å¯ä»¥åˆ›å»ºç”µå½±ã€‚å¦‚æœæ‚¨æ²¡æœ‰ FFmegï¼Œå¯ä»¥ä»ä»¥ä¸‹ç½‘å€ä¸‹è½½:</p><div class="nb nc gp gr nd ne"><a href="https://www.ffmpeg.org/" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">FFmpeg</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">Stanislav Dolganov è®¾è®¡å¹¶å®ç°äº†æ— æŸè¿åŠ¨ä¼°è®¡å’Œè¡¥å¿çš„å®éªŒæ”¯æŒã€‚</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">www.ffmpeg.org</p></div></div></div></a></div><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="7bfa" class="mu lm iq mq b gy mv mw l mx my">#Step 3 - Creating a movie from the images (please note that ffmeg is on my C:/)<br/>makemovie_cmd &lt;- paste0("C:/ffmpeg/bin/ffmpeg -framerate 5 -y -i ", paste0(getwd(), "/maps/img_%7d.png"),  " -r 56 -pix_fmt yuv420p ",  paste0(getwd(), "/maps/"), "sakura_movie.mp4")<br/>system(makemovie_cmd)</span></pre><p id="e531" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç„¶ååœ¨åœ°å›¾æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª sakura_movie.mp4ã€‚ä½ å¯ä»¥åœ¨<a class="ae kx" href="https://github.com/tristanga/Visualizing-Japan-cherry-blossom-season-forecast-2018" rel="noopener ugc nofollow" target="_blank"> Github </a>ä¸Šæ‰¾åˆ°å®Œæ•´çš„ä»£ç å’Œæ–‡ä»¶ã€‚</p><div class="nb nc gp gr nd ne"><a href="https://github.com/tristanga/Visualizing-Japan-cherry-blossom-season-forecast-2018" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">ç‰¹é‡Œæ–¯å¦åŠ /å¯è§†åŒ–-æ—¥æœ¬-æ¨±èŠ±-å­£èŠ‚-é¢„æµ‹-2018 å¹´</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">å¯è§†åŒ–-æ—¥æœ¬-æ¨±èŠ±-å­£èŠ‚-é¢„æµ‹-2018 -å¦ä¸€ä¸ªç”¨äºæ•™è‚²ç›®çš„çš„åŠ¨ç”»æ•°æ®å¯è§†åŒ–</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">github.com</p></div></div><div class="nn l"><div class="no l np nq nr nn ns kv ne"/></div></div></a></div><p id="41bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¦‚æœä½ å–œæ¬¢è¿™ä¸ªå¯è§†åŒ–æ•ˆæœï¼Œåˆ«å¿˜äº†ç”¨æ–‡ç« é¡µé¢ä¸Šçš„é¼“æŒæŒ‰é’®é¼“æŒğŸ‘ã€‚æ¯ç¯‡å¸–å­æœ€å¤šå¯ä»¥é¼“æŒ 50 æ¬¡ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶é€šè¿‡<a class="ae kx" href="https://www.linkedin.com/in/tristanganry/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>è”ç³»æˆ‘ã€‚</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/ebd3f8cfe174532f03aae12371794fef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*ETzfjKn55RLOvXWYxJ1xLQ.png"/></div></figure></div></div>    
</body>
</html>